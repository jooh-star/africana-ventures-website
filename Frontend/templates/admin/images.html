{% extends "admin/base.html" %}

{% block title %}Image Management{% endblock %}
{% block page_title %}Website Images{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">Website Images</h2>
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#uploadModal">
        <i class="fas fa-upload"></i> Upload Image
    </button>
</div>

<!-- Upload Modal -->
<div class="modal fade" id="uploadModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-upload"></i> Upload New Image</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="{{ url_for('admin.upload_image') }}" enctype="multipart/form-data">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="image" class="form-label">Image File *</label>
                                <input type="file" class="form-control" id="image" name="image" required accept="image/*">
                                <div class="form-text">Max size: 16MB. Supported formats: JPG, PNG, GIF, WebP</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="section" class="form-label">Section *</label>
                                <select class="form-select" id="section" name="section" required>
                                    <option value="">Select Section</option>
                                    <option value="hero">Hero Section</option>
                                    <option value="about">About Page</option>
                                    <option value="services">Services Page</option>
                                    <option value="team">Team Section</option>
                                    <option value="contact">Contact Page</option>
                                    <option value="gallery">Gallery</option>
                                    <option value="background">Background Images</option>
                                    <option value="logo">Logo & Branding</option>
                                </select>
                                <div id="section-recommendation" class="form-text mt-2">
                                    Select a section to see recommendations.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <input type="text" class="form-control" id="description" name="description" 
                               placeholder="Brief description of the image">
                    </div>
                    
                    <div class="mb-3">
                        <label for="alt_text" class="form-label">Alt Text</label>
                        <input type="text" class="form-control" id="alt_text" name="alt_text" 
                               placeholder="Alternative text for accessibility">
                        <div class="form-text">Important for SEO and accessibility</div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="display_order" class="form-label">Display Order</label>
                                <input type="number" class="form-control" id="display_order" name="display_order" 
                                       value="0" min="0">
                                <div class="form-text">Lower numbers appear first</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="is_featured" name="is_featured">
                                    <label class="form-check-label" for="is_featured">
                                        Featured Image
                                    </label>
                                    <div class="form-text">Mark as featured/hero image</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-upload"></i> Upload Image
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Image Grid -->
<div class="row">
    {% for image in images %}
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="card h-100">
            <div class="position-relative">
                <img src="{{ url_for('static', filename='uploads/' + image.filename) }}" 
                     class="card-img-top" 
                     alt="{{ image.alt_text or image.description or 'Website image' }}"
                     style="height: 200px; object-fit: cover;">
                
                <div class="position-absolute top-0 end-0 p-2">
                    {% if image.is_featured %}
                    <span class="badge bg-warning">
                        <i class="fas fa-star"></i> Featured
                    </span>
                    {% endif %}
                    <span class="badge bg-{{ 'success' if image.is_active else 'secondary' }}">
                        {{ 'Active' if image.is_active else 'Inactive' }}
                    </span>
                </div>
            </div>
            
            <div class="card-body">
                <h6 class="card-title">{{ image.original_filename }}</h6>
                <p class="text-muted mb-2">
                    <i class="fas fa-folder"></i> {{ image.section|title }}
                </p>
                
                {% if image.description %}
                <p class="card-text small">{{ image.description }}</p>
                {% endif %}
                
                {% if image.alt_text %}
                <p class="card-text small text-muted">
                    <strong>Alt:</strong> {{ image.alt_text }}
                </p>
                {% endif %}
                
                <div class="d-flex justify-content-between align-items-center">
                    <small class="text-muted">
                        <i class="fas fa-calendar"></i> {{ image.created_at.strftime('%Y-%m-%d') }}
                    </small>
                    <div class="btn-group">
                        <button type="button" class="btn btn-outline-primary btn-sm" 
                                onclick="viewImage('{{ url_for('static', filename='uploads/' + image.filename) }}', '{{ image.original_filename }}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <a href="{{ url_for('admin.edit_image', image_id=image.id) }}" 
                           class="btn btn-outline-secondary btn-sm">
                            <i class="fas fa-edit"></i>
                        </a>
                        <a href="{{ url_for('admin.toggle_image', image_id=image.id) }}" 
                           class="btn btn-outline-{{ 'warning' if image.is_active else 'success' }} btn-sm">
                            <i class="fas fa-{{ 'eye-slash' if image.is_active else 'eye' }}"></i>
                        </a>
                        <a href="{{ url_for('admin.delete_image', image_id=image.id) }}" 
                           class="btn btn-outline-danger btn-sm"
                           onclick="return confirm('Are you sure you want to delete this image?')">
                            <i class="fas fa-trash"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="col-12">
        <div class="card">
            <div class="card-body text-center py-5">
                <i class="fas fa-images fa-3x text-muted mb-3"></i>
                <h5 class="text-muted">No images uploaded yet</h5>
                <p class="text-muted">Start by uploading your first image.</p>
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#uploadModal">
                    <i class="fas fa-upload"></i> Upload Image
                </button>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Image View Modal -->
<div class="modal fade" id="imageViewModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="imageViewTitle">Image Preview</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center">
                <img id="imageViewSrc" src="" alt="" class="img-fluid" style="max-height: 500px;">
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function viewImage(src, title) {
    document.getElementById('imageViewSrc').src = src;
    document.getElementById('imageViewTitle').textContent = title;
    new bootstrap.Modal(document.getElementById('imageViewModal')).show();
}

// Display recommendations based on selected section
document.addEventListener('DOMContentLoaded', function() {
    const sectionSelect = document.getElementById('section');
    const recommendationDiv = document.getElementById('section-recommendation');
    
    function updateRecommendation() {
        const section = sectionSelect.value;
        let recommendation = '';
        
        switch(section) {
            case 'hero':
                recommendation = '<strong>Recommendation:</strong> Use high-quality, wide landscape images (1920×1080px). These images appear at the top of the homepage and should represent your brand identity.';
                break;
            case 'about':
                recommendation = '<strong>Recommendation:</strong> Use images that tell your company story or show your team in action (800×600px). These appear on the About page.';
                break;
            case 'services':
                recommendation = '<strong>Recommendation:</strong> Use images that represent your services or show results (800×600px). These appear on the Services page.';
                break;
            case 'team':
                recommendation = '<strong>Recommendation:</strong> Use professional headshots or team photos (400×400px, square). These appear in the team section.';
                break;
            case 'contact':
                recommendation = '<strong>Recommendation:</strong> Use images of your office or contact-related visuals (800×600px). These appear on the Contact page.';
                break;
            case 'gallery':
                recommendation = '<strong>Recommendation:</strong> Use high-quality project photos or portfolio items (800×600px). These appear in the gallery section.';
                break;
            case 'background':
                recommendation = '<strong>Recommendation:</strong> Use subtle patterns or textures that don\'t distract from content (1920×1080px). These are used as section backgrounds.';
                break;
            case 'logo':
                recommendation = '<strong>Recommendation:</strong> Use transparent PNG files for logos (at least 200×200px). These appear in the header, footer, and favicon.';
                break;
            default:
                recommendation = 'Select a section to see recommendations.';
        }
        
        recommendationDiv.innerHTML = recommendation;
    }
    
    // Initial update
    if (sectionSelect) {
        updateRecommendation();
        
        // Update on change
        sectionSelect.addEventListener('change', updateRecommendation);
    }
});
</script>
{% endblock %}
